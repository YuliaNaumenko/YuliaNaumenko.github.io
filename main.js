var Stream=function(){function a(a){void 0===a&&(a={}),this.Id=a._id,this.PreviewImageUrl=a.preview.medium,this.DisplayName=a.channel.display_name,this.GameName=a.game,this.Viewers=a.viewers,this.Description=a.channel.status}return a}(),QueryInfo=function(){function a(a,b,c){this.SearchString=a||"",this.TotalCount=b||0,this.CurrentPage=c||1}return Object.defineProperty(a.prototype,"TotalPages",{get:function(){return this.TotalCount>0?Math.ceil(this.TotalCount/5):0},enumerable:!0,configurable:!0}),a}(),CallbackRegistry={},JSONPHandler=function(){function a(){}return a.prototype.load=function(a,b,c){function d(){e||(delete CallbackRegistry[f],c(a))}var e=!1,f="cb"+String(Math.random()).slice(-6);a+=~a.indexOf("?")?"&":"?",a+="client_id=luqvyoa6utwz5evwsxo0tkjd3bdjk3&callback=CallbackRegistry."+f,CallbackRegistry[f]=function(a){e=!0,delete CallbackRegistry[f],b(a)};var g=document.createElement("script");g.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,setTimeout(d,0))},g.onload=g.onerror=d,g.src=a,document.body.appendChild(g)},a}(),SearchStreamService=function(){function a(){var a=this;return a.parseResult=function(b){var c=b._total,d=b.streams||[],e=[];for(i=0;i<d.length;i++)e.push(new Stream(d[i]));a.fnCallback(e,c)},a.jsonpHandler=new JSONPHandler,a}return a.prototype.getStreamCollection=function(a,b,c,d){var e="https://api.twitch.tv/kraken/search/streams?query=";e+=encodeURIComponent(a),"number"==typeof c&&(e+="&offset="+c),e+="number"==typeof d&&d>0?"&limit="+d:"&limit=5",this.fnCallback=b,this.jsonpHandler.load(e,this.parseResult,this.errorHandler)},a.prototype.errorHandler=function(a){console.error(a)},a}(),TemplateFetcher=function(){function a(){}return a.prototype.fetchTemplateByPath=function(a,b){var c=new XMLHttpRequest;c.callback=b,c.onload=function(a){200===this.status&&this.callback.apply(this)},c.onerror=function(a){console.error(this.statusText)},c.open("GET",a,!0),c.send()},a.init=function(){var b=new this;return a.current=b},a}(),BaseViewComponent=function(){function a(){}return a.prototype.renderTemplate=function(a){throw"Method renderTemplate should be overridden by the child class"},a.prototype.fetchTemplate=function(a){var b=this;TemplateFetcher.current.fetchTemplateByPath(a,function(){b.renderTemplate.call(b,this.responseText)})},a.prototype.getElementByClassName=function(a){try{var b=document.getElementsByClassName(a);if(b.length>0)return b[0];throw"DOM element with class name '"+a+"' does not exist."}catch(a){console.error(a)}},a}(),__extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},StreamListItem=function(a){function b(b,c){a.call(this),this.streamItem=b,this.viewHolder=document.getElementsByClassName(c)[0]}return __extends(b,a),b.prototype.activate=function(){this.fetchTemplate("app/templates/StreamListItem.html")},b.prototype.renderTemplate=function(a){var b=this;for(var c in b.streamItem)a=a.replace("{{"+c+"}}",b.streamItem[c]);b.viewHolder.innerHTML=b.viewHolder.innerHTML+a},b}(BaseViewComponent||{}),__extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},StreamsList=function(a){function b(b){a.call(this);var c=this;return c.streamItems=[],c.queryInfo=new QueryInfo,c.streamService=new SearchStreamService,c.viewHolder=document.getElementsByClassName(b)[0],c.getStreamsList=function(a,b){c.streamItems=a,c.queryInfo.TotalCount=b,c.fetchTemplate("app/templates/StreamsList.html")},c}return __extends(b,a),b.prototype.executeSearch=function(a){this.queryInfo.CurrentPage+=a,this.streamService.getStreamCollection(this.queryInfo.SearchString,this.getStreamsList,this.queryInfo.CurrentPage)},b.prototype.activate=function(a){this.queryInfo.SearchString=a,this.executeSearch(0)},b.prototype.renderTemplate=function(a){var b=this;for(var c in b.queryInfo)a=a.replace("{{"+c+"}}",b.queryInfo[c]);if(b.viewHolder.innerHTML=a,b.queryInfo.TotalCount>0){var d=this.getElementByClassName("next-page");b.queryInfo.TotalPages>b.queryInfo.CurrentPage?d.addEventListener("click",b.executeSearch.bind(b,1)):d.style.visibility="hidden";var e=this.getElementByClassName("prev-page");b.queryInfo.CurrentPage>1?e.addEventListener("click",b.executeSearch.bind(b,-1)):e.style.visibility="hidden"}else{this.getElementByClassName("paging-control").style.visibility="hidden"}for(i=0;i<b.streamItems.length;i++){new StreamListItem(b.streamItems[i],"streams").activate()}},b}(BaseViewComponent||{}),__extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},SearchListController=function(a){function b(){a.call(this),this.searchString=""}return __extends(b,a),b.prototype.init=function(){this.fetchTemplate("app/templates/SearchListView.html")},b.prototype.refreshSearchList=function(a){if(this.searchString&&""!==this.searchString){new StreamsList("search-list").activate(this.searchString)}else alert("Search query is required. Please enter the value.")},b.init=function(){return(new this).init()},b.prototype.setSearchString=function(a){a.preventDefault(),13==a.keyCode?this.refreshSearchList():this.searchString=a.target.value},b.prototype.renderTemplate=function(a){var b=this,c=document.getElementById("applicationHost");c.innerHTML=c.innerHTML+a,b.getElementByClassName("executeSearch").addEventListener("click",b.refreshSearchList.bind(b)),b.getElementByClassName("searchString").addEventListener("keyup",b.setSearchString.bind(b))},b}(BaseViewComponent||{}),App=function(a){return a.init=function(){TemplateFetcher.init(),SearchListController.init()},a}(App||{});App.init();